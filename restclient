# -*- restclient -*-

:api = localhost:40666
:headers = <<
Content-Type: application/json

:auth-headers = <<
Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJtZUBleGFtcGxlLm9yZyIsImF1ZCI6InN5cmlhbi1hcmNoaXZlIiwiZXhwIjoxNTkxMTI3ODM4LCJuYmYiOjE1OTExMjQyMzh9.YZA0D36hDHsgT9NA9VVWawoIzcumwSWaXGo-apzBmCGfnY2pimR8R0fUtZjWXcQx9X2pzfrED_jbrKE5i3S2Dg
X-Forwarded-For: 192.168.2.5

###
# Ncube Host Configuration
###

# Query the global Ncube configuration.
GET http://:api/api
:headers
:auth-headers

# Bootstrap Ncube.
POST http://:api/api
:headers

[{"name": "workspace_root", "value": "~/ncube"}]

# Update Ncube host configuration.
PUT http://:api/api
:headers

[{"name": "name", "value": "~/ncube"}]


###
# Account Management
###

# Login an account
POST http://:api/api/workspaces/syrian-archive/account
:headers

{
  "email": "me@example.org",
  "password": "new-pass"
}

# Update a password
PUT http://:api/api/workspaces/syrian-archive/account
:headers

{
  "email": "me@example.org",
  "password": "new-pass"
}

###
# Manage Workspaces
###

# Create a new workspace.
POST http://:api/api/workspaces
:headers

{
  "name": "Syrian Archive",
  "description": "This is a workspace.",
  "kind": "local",
  "database": "http"
}


# Link a new remote workspace
POST http://:api/api/workspaces
:headers

{
  "name": "Syrian Archive Remote",
  "description": "This is a workspace.",
  "kind": "remote",
  "endpoint": "https://example.org/workspaces/syrian-archive",
  "database": "http"
}

# List all workspaces.
GET http://:api/api/workspaces
:headers

# Show a single workspace.
GET http://:api/api/workspaces/syrian-archive
:headers

# Remove a single workspace.
DELETE http://:api/api/workspaces/syrian-archive
:headers

# Create a new workspace.
PUT http://:api/api/workspaces/syrian-archive
:headers

{
  "name": "Syrian Archivee",
  "description": "This is a workspace.",
  "kind": "local",
  "location": "~/path/to/workspace",
  "database": "sqlite"
}


###
# Manage sources
###

# Create a new source
POST http://:api/api/workspaces/syrian-archive/sources
:headers

{
  "type": "youtube_video",
  "term": "https://youtube.com/watch?v=123456",
  "annotations": [
    {"type": "tag", "term": "xyz"},
    {"type": "tag", "term": "zyx"}
  ]
}

# Create a source for a non existing workspace
POST http://:api/api/workspaces/dont-exist/sources
:headers

{
  "type": "youtube_video",
  "term": "https://youtube.com/watch?v=123456",
  "annotations": [
    {"type": "tag", "term": "xyz"},
    {"type": "tag", "term": "zyx"}
  ]
}

# List all sources
GET http://:api/api/workspaces/syrian-archive/sources

# Delete a source
DELETE http://:api/api/workspaces/syrian-archive/sources/1

# Update an existing source
PUT http://:api/api/workspaces/syrian-archive/sources/1
:headers

{
  "type": "youtube_video",
  "term": "https://youtube.com/watch?v=654321",
  "annotations": [
    {"type": "tag", "term": "xyz"},
    {"type": "tag", "term": "zyx"}
  ]
}
